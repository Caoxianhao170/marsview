import{a as E,u as L,b as O,j as e,C as U,m as u,c as I,M as D,e as z,f as w}from"./index--hJz74lv.js";import{s as l}from"./index.module-DFRKY25f.js";import{E as A,C as F,S as $,a,b as d}from"./SendOutlined-DpRaSAdW.js";import{U as B}from"./UserOutlined-B1KxMA--.js";import{D as M}from"./DeleteOutlined-DsRQlQUA.js";const G=window.React.useEffect,H=window.React.useRef,p=window.React.useState,V=window.antd.Button,W=window.antd.Col,q=window.antd.Empty,J=window.antd.Image,K=window.antd.Layout,Q=window.antd.Pagination,X=window.antd.Row,Y=window.antd.Spin,j=window.antd.Tag,r=window.antd.Tooltip,Z=window.dayjs;function le(){const[s,n]=p(!0),[i,c]=p([]),[h,_]=p(0),[f,v]=p(1),[m,C]=p(!1),[R,T]=p(""),y=H(),{userInfo:te,isUpdateList:k}=E(t=>({userInfo:t.userInfo,isUpdateList:t.isUpdateList})),P=L();G(()=>{x()},[k]);const x=async(t=f)=>{n(!0);try{const o=await O({pageNum:t,pageSize:12});_((o==null?void 0:o.total)||0),c((o==null?void 0:o.list)||[]),n(!1)}catch{n(!1)}},S=t=>{v(t),x(t)},b=()=>{var t;(t=y.current)==null||t.open()},g=async(t,o,N)=>{if(t==="preview"){if(!o.preview_img)return u.warning("该页面未生成预览图");T(o.preview_img),C(!0);return}if(!N)return u.warning("该页面未授权，无法访问");if(t==="edit")return P(`/editor/${o==null?void 0:o.id}/edit`);t==="copy"&&(await I({id:o.id}),u.success("复制成功"),x()),t==="delete"&&D.confirm({title:"确认",content:"确认删除吗？",okText:"确认",cancelText:"取消",onOk:async()=>{await z({id:o.id}),u.success("删除成功"),x()}})};return e.jsx(e.Fragment,{children:e.jsxs(K.Content,{className:l.pageList,children:[e.jsx(Y,{spinning:s,size:"large",children:e.jsx(X,{gutter:[20,20],children:i.map(t=>{const o=!!t.id;return e.jsx(W,{span:6,children:e.jsxs("section",{className:l.card,style:{borderRadius:8,opacity:o?1:.6,background:o?"none":"url('/imgs/cross-bg.png')",overflow:"hidden"},children:[e.jsxs("div",{className:l.itemContent,onClick:()=>g("edit",t,o),children:[e.jsx("div",{className:l.itemHeader,children:e.jsx(ee,{item:t})}),e.jsx("div",{className:l.itemTitle,children:t.name}),e.jsx("div",{className:l.itemRemark,children:t.remark||"暂无描述"}),e.jsxs("div",{className:l.updateUser,children:[e.jsxs("span",{style:{marginRight:10},children:[e.jsx(B,{style:{fontSize:15,marginRight:5}}),t.user_name]}),e.jsxs("span",{children:["更新时间：",Z(t.updated_at).fromNow()]})]})]}),e.jsxs("div",{className:l.itemFooter,children:[e.jsx(r,{title:"效果图预览",children:e.jsx(A,{onClick:()=>g("preview",t,o)})}),e.jsx(r,{title:"页面复制",children:e.jsx(F,{onClick:()=>g("copy",t,o)})}),e.jsx(r,{title:"页面删除",children:e.jsx(M,{onClick:()=>g("delete",t,o)})}),e.jsx(r,{title:"页面访问",children:e.jsx($,{onClick:()=>{window.open(`http://admin.marsview.cc/page/prd/${t.id}`,"_blank")}})})]})]},t.id)},t.id)})})}),e.jsx(J,{style:{display:"none"},src:R,preview:{visible:m,onVisibleChange:t=>{C(t)}}}),h>0?e.jsx(Q,{style:{textAlign:"right",marginTop:16},total:h,current:f,pageSize:12,showTotal:t=>`总共 ${t} 条`,onChange:S}):!s&&e.jsx(q,{style:{marginTop:100},children:e.jsx(V,{type:"primary",onClick:b,children:"创建页面"})}),e.jsx(U,{createRef:y})]})})}const ee=({item:s})=>{if(s.stg_state===1&&s.pre_state===1&&s.prd_state===1)return e.jsx(j,{children:e.jsx(r,{title:"待开发",children:"NEW"})});let n={color:"",icon:e.jsx(a,{}),tooltip:"已发布"},i={color:"",icon:e.jsx(a,{}),tooltip:"已发布"},c={color:"",icon:e.jsx(a,{}),tooltip:"已发布"};return s.stg_state===4?n={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:s.stg_state===3?n={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:s.stg_state===2&&s.stg_publish_id?n={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:n={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},s.pre_state===4?i={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:s.pre_state===3?i={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:s.pre_state===2&&s.pre_publish_id?i={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:i={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},s.prd_state===4?c={color:"red",icon:e.jsx(d,{}),tooltip:"版本已回滚"}:s.prd_state===3?c={color:"success",icon:e.jsx(a,{}),tooltip:"版本已发布"}:s.prd_state===2&&s.prd_publish_id?c={color:"warning",icon:e.jsx(d,{}),tooltip:"版本已落后"}:c={color:"",icon:e.jsx(w,{}),tooltip:"版本未发布"},e.jsxs(e.Fragment,{children:[e.jsx(r,{title:n.tooltip,children:e.jsx(j,{color:n.color,icon:n.icon,children:"STG"})}),e.jsx(r,{title:i.tooltip,children:e.jsx(j,{color:i.color,icon:i.icon,children:"PRE"})}),e.jsx(r,{title:c.tooltip,children:e.jsx(j,{color:c.color,icon:c.icon,children:"PRD"})})]})};export{le as default};
