import{o as $,ap as D,aq as E,j as e,C as A,ar as z,as as B,m as M,at as G,M as H,au as U}from"./index-BBkS68sv.js";import{m as T,I as K}from"./index-D9JUB6hU.js";import{a as J}from"./pageMember-Dpti6EYv.js";import{S as Q}from"./SearchForm-B1iYemKz.js";import"./index-DsdcxFhl.js";import"./SendOutlined-B7Eu_wmm.js";import"./CodeOutlined-EqGcmDkC.js";import"./DeleteOutlined-B6bglta-.js";import"./SaveOutlined-BQ_jcTgK.js";import"./LockOutlined-Ds8QM0LA.js";import"./TeamOutlined-D9jTqjd3.js";import"./UserOutlined-BbJ58T22.js";const W=window.React,X=window.React.useImperativeHandle,Y=window.React.useRef,m=window.React.useState,Z=window.antd.Modal,s=window.antd.Form,ee=window.antd.TreeSelect,j=window.antd.Input,w=window.antd.Select,N=window.antd.InputNumber,c=window.antd.Radio,te=window.antd.Spin;function ne(p){const[l]=s.useForm(),x=Y(),[y,u]=m("create"),[I,o]=m(!1),[r,v]=m([]),[C,S]=m([]),[R,g]=m(!1),[k,h]=m(!1),{id:t}=$();X(p.mRef,()=>({open:a}));const a=async(i,n)=>{var F;u(i),o(!0),g(!0),await d(),await b(),g(!1),n&&t&&l.setFieldsValue({...n,project_id:parseInt(t),code:((F=n.code)==null?void 0:F.split("_")[2])||""})},d=async()=>{if(!t)return;const i=await D({project_id:parseInt(t)}),n=E(i.list);v(n)},b=async()=>{const i=await J.getPageList();S(i.list)},P=async()=>{if(await l.validateFields()){h(!0);const n=l.getFieldsValue();try{n.type===2?n.code=n.project_id+"_"+n.parent_id+"_"+n.code:n.code="",n.page_id=n.page_id||0,y==="create"?await z(n):await B(n),h(!1),M.success("操作成功"),O(),p.update()}catch{h(!1)}}},O=()=>{o(!1),l.resetFields()},q=T;return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:y==="create"?"创建菜单":"编辑菜单",width:800,open:I,okText:"确定",cancelText:"取消",confirmLoading:k,onOk:P,onCancel:O,children:e.jsx(te,{spinning:R,children:e.jsxs(s,{form:l,labelAlign:"right",labelCol:{span:4},initialValues:{type:1,status:1},children:[e.jsx(s.Item,{hidden:!0,name:"id",children:e.jsx(j,{})}),e.jsx(s.Item,{hidden:!0,name:"project_id",children:e.jsx(N,{})}),e.jsx(s.Item,{label:"上级菜单",name:"parent_id",children:e.jsx(ee,{placeholder:"请选择父级菜单",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"name",value:"id"},treeData:r})}),e.jsx(s.Item,{label:"菜单类型",name:"type",children:e.jsxs(c.Group,{children:[e.jsx(c,{value:1,children:"菜单"}),e.jsx(c,{value:2,children:"按钮"}),e.jsx(c,{value:3,children:"页面"})]})}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const i=l.getFieldValue("type");return i===1?e.jsx(s.Item,{label:"菜单名称",name:"name",rules:[{required:!0,message:"请输入菜单名称"}],children:e.jsx(j,{placeholder:"请输入菜单名称",allowClear:!0})}):i===2?e.jsx(s.Item,{label:"按钮名称",name:"name",rules:[{required:!0,message:"请输入按钮名称"}],children:e.jsx(j,{placeholder:"请输入按钮名称",allowClear:!0})}):e.jsx(s.Item,{label:"页面名称",name:"name",rules:[{required:!0,message:"请输入页面名称"}],children:e.jsx(j,{placeholder:"请输入页面名称",allowClear:!0})})}}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const i=l.getFieldValue("type");return i===2?e.jsx(s.Item,{label:"权限标识",name:"code",extra:"同一个菜单下不要重名即可",children:e.jsx(j,{placeholder:"权限标识，例如: create、edit、export"})}):e.jsxs(e.Fragment,{children:[i===1?e.jsx(s.Item,{label:"菜单图标",name:"icon",children:e.jsx(w,{placeholder:"请选择菜单图表",showSearch:!0,allowClear:!0,children:Object.keys(T).filter(n=>!["default","createFromIconfontCN","getTwoToneColor","setTwoToneColor","IconProvider"].includes(n)).map(n=>e.jsx(w.Option,{value:n,children:W.createElement(q[n],{style:{fontSize:"24px",verticalAlign:"middle"}})},n))})}):null,e.jsx(s.Item,{label:"关联页面",tooltip:"选择你创建的页面",extra:e.jsxs("span",{children:["暂无页面？",e.jsx("a",{onClick:()=>{var n;(n=x.current)==null||n.open()},children:"去创建"})]}),name:"page_id",children:e.jsxs(w,{placeholder:"请选择关联页面",allowClear:!0,children:[e.jsx(w.Option,{value:0,children:"空页面"},"empty"),C.map(n=>e.jsx(w.Option,{value:n.id,children:n.name+"( "+n.remark+" )"},n.id))]})})]})}}),e.jsx(s.Item,{label:"排序",name:"sort_num",tooltip:{title:"排序值越大越靠后",icon:e.jsx(K,{})},children:e.jsx(N,{placeholder:"请输入排序值"})}),e.jsx(s.Item,{label:"菜单状态",name:"status",children:e.jsxs(c.Group,{children:[e.jsx(c,{value:1,children:"启用"}),e.jsx(c,{value:2,children:"停用"})]})})]})})}),e.jsx(A,{createRef:x,update:()=>b()})]})}const ae=window.React,se=window.React.useEffect,ie=window.React.useRef,V=window.React.useState,L=window.antd.Form,le=window.antd.Input,f=window.antd.Button,re=window.antd.Table,oe=window.antd.Space,_=window.antd.Select;function ge(){const[p]=L.useForm(),[l,x]=V([]),[y,u]=V(!1),I=$().id,o=ie();se(()=>{r()},[]);const r=async()=>{const{name:t,status:a}=p.getFieldsValue();if(!I)return;u(!0);const d=await D({project_id:parseInt(I),name:t,status:a});if(u(!1),t||a>0)x(d.list||[]);else{const b=E(d.list);x(b||[])}},v=()=>{var t;(t=o.current)==null||t.open("create",{sort_num:l.length})},C=async t=>{u(!0),await G({id:t.id}),M.success("复制成功"),r()},S=t=>{var a,d;(d=o.current)==null||d.open("create",{parent_id:t.id,sort_num:(((a=t.children)==null?void 0:a.length)||0)+1})},R=t=>{var a;(a=o.current)==null||a.open("edit",t,l)},g=t=>{let a="";t.type==1&&(a="菜单"),t.type==2&&(a="按钮"),t.type==3&&(a="页面"),H.confirm({title:"确认",content:`确认删除该${a}吗？`,onOk(){k(t.id)}})},k=async t=>{u(!0),await U({id:t}),M.success("删除成功"),r()},h=[{title:"菜单名称",dataIndex:"name",key:"name",width:200},{title:"菜单图标",dataIndex:"icon",key:"icon",render(t){if(!t)return"-";const a=T;return ae.createElement(a[t],{style:{fontSize:"25px"}})}},{title:"菜单类型",dataIndex:"type",key:"type",render(t){return{1:"菜单",2:"按钮",3:"页面"}[t]}},{title:"权限标识",dataIndex:"code",key:"code",render(t){return t||"-"}},{title:"关联页面",dataIndex:"page_id",key:"page_id",render(t){return t||"-"}},{title:"排序值",dataIndex:"sort_num",key:"sort_num"},{title:"状态",dataIndex:"status",key:"status",render(t){return{1:"正常",2:"停用"}[t]}},{title:"创建时间",dataIndex:"created_at",key:"created_at"},{title:"创建人",dataIndex:"sso_name",key:"sso_name"},{title:"操作",key:"action",width:200,render(t,a){return e.jsxs(oe,{children:[e.jsx(f,{type:"text",onClick:()=>C(a),children:"复制"}),e.jsx(f,{type:"text",onClick:()=>S(a),children:"新增"}),e.jsx(f,{type:"text",onClick:()=>R(a),children:"编辑"}),e.jsx(f,{type:"text",danger:!0,onClick:()=>g(a),children:"删除"})]})}}];return e.jsxs("div",{children:[e.jsxs(Q,{form:p,initialValues:{status:-1},submit:r,reset:r,children:[e.jsx(L.Item,{label:"菜单名称",name:"name",children:e.jsx(le,{placeholder:"菜单名称"})}),e.jsx(L.Item,{label:"菜单状态",name:"status",children:e.jsxs(_,{style:{width:100},children:[e.jsx(_.Option,{value:-1,children:"所有"}),e.jsx(_.Option,{value:1,children:"正常"}),e.jsx(_.Option,{value:2,children:"停用"})]})})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"菜单列表"}),e.jsx("div",{className:"action",children:e.jsx(f,{type:"primary",onClick:v,children:"新增"})})]}),e.jsx(re,{bordered:!0,rowKey:"id",loading:y,columns:h,dataSource:l,pagination:!1})]}),e.jsx(ne,{mRef:o,update:r})]})}export{ge as default};
