import{j as s,m as C}from"./index-BMoS0DUA.js";import{F as P}from"./context-V_gTMpak.js";import{e as I,b as W,r as v}from"./index-TNyY8g-O.js";import{P as D}from"./PlusOutlined-CrNRbnjj.js";import"./_commonjsHelpers-BosuxZz1.js";import"./immer-DZPz5TFl.js";import"./objectSpread2-C4CkhkJ7.js";import"./PlusOutlined-B9smaIDR.js";const N=window.React.forwardRef,A=window.React.useContext,M=window.React.useEffect,B=window.React.useImperativeHandle,E=window.React.useMemo,T=window.React.useState,H=window.antd.Table,c=window.antd.Form,g=window.antd.Input,K=window.antd.InputNumber,O=window.antd.Select,$=window.antd.DatePicker,q=window.antd.Switch,z=window.antd.Space,G=window.antd.Button,J=window.dayjs;function L({id:l,type:t,config:o},d){const[u,i]=T(!0),x=A(P);return B(d,()=>({show(){i(!0)},hide(){i(!1)}})),u&&s.jsx(c.Item,{...o.props.formItem,"data-id":l,"data-type":t,children:s.jsx(Q,{config:o,form:x})})}function Q({config:l,form:t}){var b,j,f,k,V;const[o,d]=T([]),u=E(()=>{var e;const n={key:I("key")};return(e=l.props.formWrap)==null||e.columns.map(a=>{W(a.defaultValue)&&(a.type==="date"?typeof a.defaultValue=="string"?n[a.dataIndex]=J(a.defaultValue):n[a.dataIndex]=a.defaultValue:a.type==="select"?a.dataSource==="static"?n[a.dataIndex]=a.dataType==="text"?a.defaultValue:Number(a.defaultValue):n[a.dataIndex]=v(a.options.value):n[a.dataIndex]=a.defaultValue)}),n},[(b=l.props.formWrap)==null?void 0:b.columns]);M(()=>{const n=t==null?void 0:t.getFieldValue(l.props.formItem.name);if(n)n.length!==o.length&&d(()=>[...n.map(e=>({...u,key:e.id||I("key")}))]);else{const e={...u,key:I("key")};t==null||t.setFieldValue(l.props.formItem.name,[e]),d(()=>[e])}},[t==null?void 0:t.getFieldValue((j=l.props.formItem)==null?void 0:j.name)]);const i=n=>{var a;if(!l.props.formItem.name)return C.error("请配置name字段");const e=((a=t==null?void 0:t.getFieldsValue())==null?void 0:a[l.props.formItem.name])||[];e.splice(n+1,0,{...u,key:I("key")}),t==null||t.setFieldValue(l.props.formItem.name,[...e]),d(()=>[...e.map(r=>({...r,key:r.key||r.id||I("key")}))])},x=n=>{var a;const e=((a=t==null?void 0:t.getFieldsValue())==null?void 0:a[l.props.formItem.name])||[];e.splice(n,1),t==null||t.setFieldValue(l.props.formItem.name,[...e]),d(()=>[...e])},h=E(()=>{var n;return{...l.props.formWrap,rowKey:"key",columns:(n=l.props.formWrap)==null?void 0:n.columns.map((e,a)=>{var F,R;const r=[];return(R=(F=e.formItem)==null?void 0:F.rules)==null||R.map(w=>{const m={...w};w.pattern&&(m.pattern=new RegExp(w.pattern)),r.push(m)}),{...e,key:e.dataIndex||a,render(w,m,y){if(e.type==="label")return w;if(e.type==="text")return s.jsx(c.Item,{style:{margin:0},name:[l.props.formItem.name,y,e.dataIndex],colon:!1,label:" ",rules:r,children:s.jsx(g,{placeholder:e.placeholder,style:{width:"100%"}})});if(e.type==="number")return s.jsx(c.Item,{style:{margin:0},name:[l.props.formItem.name,y,e.dataIndex],colon:!1,label:" ",rules:r,children:s.jsx(K,{placeholder:e.placeholder,style:{width:"100%"}})});if(e.type==="select"){let p=[];return e.dataSource==="dynamic"?(p=v(e.options.value)||[],Array.isArray(p)&&e.field.label&&e.field.value&&(p=p.map(S=>({label:S[e.field.label],value:S[e.field.value]})))):p=e.options||[],s.jsx(c.Item,{style:{margin:0},name:[l.props.formItem.name,y,e.dataIndex],colon:!1,label:" ",rules:r,children:s.jsx(O,{placeholder:e.placeholder,options:p||[],mode:e.mode,style:{width:"100%"}})})}if(e.type==="date")return s.jsx(c.Item,{style:{margin:0},name:[l.props.formItem.name,y,e.dataIndex],colon:!1,label:" ",rules:r,children:s.jsx($,{placeholder:e.placeholder,format:e.format,style:{width:"100%"}})});if(e.type==="switch")return s.jsx(c.Item,{style:{margin:0},name:[l.props.formItem.name,y,e.dataIndex],colon:!1,label:" ",rules:r,children:s.jsx(q,{})})}}}).concat([{title:"操作",key:"action",align:"center",render(e,a,r){return s.jsxs(z,{children:[s.jsx("a",{onClick:()=>i(r),children:"添加"}),s.jsx("a",{onClick:()=>x(r),children:"删除"})]})}}]),dataSource:o}},[o,(f=l.props.formWrap)==null?void 0:f.columns]);return s.jsxs(s.Fragment,{children:[s.jsx(H,{...h,pagination:!1,scroll:{x:(k=h.scroll)==null?void 0:k.x,y:(V=h.scroll)==null?void 0:V.y}}),s.jsx(G,{type:"dashed",block:!0,icon:s.jsx(D,{}),style:{marginTop:10},onClick:()=>i(o.length),children:"增加一行"})]})}const le=N(L);export{le as EditTable};
