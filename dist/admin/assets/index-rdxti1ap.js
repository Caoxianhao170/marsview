import{j as u,m as c}from"./index-BMoS0DUA.js";import{i as v}from"./index-eHDmF8kl.js";import{u as B,m as L,n as z}from"./index-TNyY8g-O.js";import"./PlusOutlined-CrNRbnjj.js";import"./objectSpread2-C4CkhkJ7.js";import"./_commonjsHelpers-BosuxZz1.js";import"./PlusOutlined-B9smaIDR.js";import"./react-is.production.min-CusjrdBo.js";import"./UploadOutlined-Bwd-S4oa.js";import"./UploadOutlined-B7yj2_9n.js";import"./LockOutlined-BVydvXBH.js";import"./MinusOutlined-BwcU5aKC.js";import"./MinusOutlined-BZaTcxGD.js";import"./UserOutlined-D3qSKySR.js";import"./immer-DZPz5TFl.js";const C=window.React,p=window.React.useState,D=window.React.useImperativeHandle,E=window.React.forwardRef,G=window.antd.Button,H=window.antd.Upload,I=({id:J,type:O,config:t,onSuccess:a,onFail:r},f)=>{const[w,n]=p(!0),[h,d]=p(!1),[R,i]=p(!1),b=B(e=>e.page.apis);D(f,()=>({show(){n(!0)},hide(){n(!1)},enable(){d(!1)},disable(){d(!0)}}));const g=e=>{var o;return((o=t.props.upload.accept)==null?void 0:o.includes(e.type))?e.size>t.props.upload.limitSize*1024*1024?(c.error("图片超出最大限制"),!1):!0:(c.error("不支持该文件格式，请重新选择"),!1)},x=e=>{i(!0);const{stgApi:l,method:m,replaceData:o,params:j}=b[t.api.id],{data:P}=L(m,o,j,{});z.post(l,{[t.props.upload.name||"file"]:e.file,...P},{headers:{"Content-Type":"multipart/form-data"}}).then(q=>{i(!1),a==null||a(q.data)}).catch(()=>{r==null||r()}).finally(()=>{i(!1)})},y=v,{button:s,upload:U}=t.props;return w&&u.jsx(H,{...U,withCredentials:!0,showUploadList:!1,style:t.style,beforeUpload:g,customRequest:x,children:u.jsx(G,{...s,icon:s.icon?C.createElement(y[s.icon]):null,loading:R,disabled:h,children:s.text})})},F=E(I);export{F as FileUpload};
